<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тема 1: Wie heißen Sie? - Уровень A1 - DeutscheSprache</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <!-- Такой же header как в level-a1.html -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="../../index.html" class="logo-link">
                    <div class="logo">DeutscheSprache</div>
                </a>
                <nav>
                    <ul>
                        <li><a href="../../index.html">Главная</a></li>
                        <li><a href="../../about.html">О сайте</a></li>
                        <li class="auth-only" style="display: none;">
                            <a href="../../profile.html">Личный кабинет</a>
                        </li>
                        <li class="auth-section">
                            <div id="userInfo" class="user-info" style="display: none;">
                                <div class="user-avatar" id="userAvatar">U</div>
                                <span id="userName">Пользователь</span>
                            </div>
                            <button id="authButton" class="auth-btn">Войти</button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div id="topic-content">
    <!-- Тема 4 A2 -->
    <div id="a2-t4" class="topic-container active-topic">
        <h2 class="topic-title">Тема 4: Präpositionen (Предлоги)</h2>
        
        <div class="rules">
            <h3>Правила и объяснения</h3>
            <p>Предлоги в немецком языке управляют определенными падежами.</p>
            <ul>
                <li>Предлоги с дательным падежом: mit, nach, aus, zu, von, bei</li>
                <li>Предлоги с винительным падежом: für, durch, gegen, ohne, um</li>
                <li>Предлоги с дательным/винительным: an, auf, hinter, in, neben, über, unter, vor, zwischen</li>
            </ul>
        </div>
        
        <div class="exercise">
            <h3>Упражнение 1: Выберите правильный предлог</h3>
            <div class="question">
                <p>Выберите правильный предлог:</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="a2t4-ex1" id="a2t4-ex1-1" value="mit">
                        <label for="a2t4-ex1-1">Ich fahre ___ dem Auto.</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="a2t4-ex1" id="a2t4-ex1-2" value="durch">
                        <label for="a2t4-ex1-2">Ich gehe ___ den Park.</label>
                    </div>
				<div class="exercise-controls">
						<button class="check-btn" onclick="checkExercise('a2t4-ex1')">Проверить</button>
						<button class="reset-btn" onclick="resetExercise('a2t4-ex1')">Сбросить</button>
					</div>
					<div class="result" id="a2t4-ex1-result"></div>
				</div>
		</div>       
             <div class="page-navigation">
                <a href="../level-a2.html" class="nav-btn">← Назад к уровню A2</a>
                <button class="nav-btn nav-btn-red complete-topic-btn" onclick="markTopicComplete('a2-t4')">
					Завершить тему
				</button>
                <a href="topic5.html" class="nav-btn">Следующая тема →</a>
            </div>
        </div>
    </section>

    <footer>
		<div class="container">
			<div class="footer-content">
				<div class="logo">DeutscheSprache</div>
				<div class="footer-links">
					<a href="../index.html">Главная</a>
					<a href="../about.html">О сайте</a>
				</div>
				<p>&copy; 2025 DeutscheSprache. Все права защищены.</p>
			</div>
		</div>
	</footer>

    <script src="../../js/auth.js"></script>
    <script src="../../js/progress.js"></script>
    <script src="../../js/app.js"></script>
    <script>
        // Защита от неавторизованного доступа
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('Для доступа к заданиям необходимо авторизоваться!');
                window.location.href = '../../index.html';
                return;
            }
        });

        // Функция для отметки темы как пройденной
function markTopicComplete(topicId) {
    const currentUser = localStorage.getItem('currentUser');
    const users = JSON.parse(localStorage.getItem('deutschUsers')) || {};
    
    if (!currentUser || !users[currentUser]) {
        showNotification('Пожалуйста, войдите в систему, чтобы сохранять прогресс!', 'error');
        return;
    }
    
    const level = topicId.split('-')[0]; // 'a1'
    const topic = topicId; // 'a1-t1'
    
    if (!users[currentUser].progress[level].topics[topic]) {
        users[currentUser].progress[level].topics[topic] = true;
        users[currentUser].progress[level].completed++;
        users[currentUser].lastActivity = new Date().toISOString();
        
        localStorage.setItem('deutschUsers', JSON.stringify(users));
        
        // Обновляем отображение прогресса
        updateProgressDisplay();
        
        // Показываем красивое уведомление
        showNotification('Тема отмечена как пройденная! Ваш прогресс обновлен.', 'success');
        
        // Обновляем индикатор прогресса темы
        const topicProgressElement = document.getElementById(`progress-${topicId}`);
        if (topicProgressElement) {
            topicProgressElement.style.width = '100%';
        }
        
        // Обновляем кнопку завершения темы
        updateCompleteButton();
        
    } else {
        showNotification('Эта тема уже отмечена как пройденная.', 'info');
    }
}

// Функция для обновления кнопки завершения темы
function updateCompleteButton() {
    const currentUser = localStorage.getItem('currentUser');
    const users = JSON.parse(localStorage.getItem('deutschUsers')) || {};
    const currentPath = window.location.pathname;
    
    // Определяем topicId из текущего URL
    let topicId = '';
    if (currentPath.includes('topic1.html')) topicId = 'a1-t1';
    if (currentPath.includes('topic2.html')) topicId = 'a1-t2';
    // Добавьте остальные темы по аналогии
    
    if (topicId && currentUser && users[currentUser] && 
        users[currentUser].progress.a1.topics[topicId]) {
        
        const completeButton = document.querySelector('.complete-topic-btn');
        if (completeButton) {
            completeButton.textContent = 'Тема уже завершена';
            completeButton.disabled = true;
            completeButton.classList.add('completed');
            completeButton.classList.remove('btn-red');
        }
    }
}

// Функция для показа красивых уведомлений
function showNotification(message, type = 'success') {
    // Создаем элемент уведомления
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-icon">${type === 'success' ? '✓' : type === 'error' ? '✕' : 'ℹ'}</span>
            <span class="notification-text">${message}</span>
        </div>
    `;
    
    // Добавляем уведомление на страницу
    document.body.appendChild(notification);
    
    // Показываем уведомление с анимацией
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // Автоматически скрываем через 4 секунды
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 4000);
}
// Инициализация при загрузке страницы темы
document.addEventListener('DOMContentLoaded', function() {
    // Проверяем, завершена ли тема и обновляем кнопку
    updateCompleteButton();
    
    // Проверяем авторизацию
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) {
        // Если не авторизован, скрываем кнопку завершения темы
        const completeButton = document.querySelector('.complete-topic-btn');
        if (completeButton) {
            completeButton.style.display = 'none';
        }
        
        // Показываем сообщение о необходимости авторизации
        const authAlert = document.createElement('div');
        authAlert.className = 'auth-alert';
        authAlert.innerHTML = `
            <h3>🔒 Для завершения темы необходима авторизация</h3>
            <p>Пожалуйста, <span class="auth-link" onclick="openAuthModal()">войдите в систему</span>, чтобы сохранять свой прогресс.</p>
        `;
        
        const pageNavigation = document.querySelector('.page-navigation');
        if (pageNavigation) {
            pageNavigation.parentNode.insertBefore(authAlert, pageNavigation);
        }
    }
});
    </script>
</body>
</html>